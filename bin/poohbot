#!/bin/zsh -eu

# imports posts from traceypooh.com

mydir=${0:a:h}
cd $mydir/../

POOH=$HOME/poohbot

# import posts
for FILE in $(cd $POOH; ls */index.html */*/index.html |tac); do
  DIR=$(dirname "$FILE")
  echo     $DIR
  mkdir -p $DIR
  (
    cat $POOH/$FILE \
      |perl -ne '$in=join("",<STDIN>); @a=split(/^---$/m,$in,2); print "---\n" . @a[0] . "comment: <script src=\"../theme.js\" type=\"module\" charset=\"utf-8\"></script>\n---\n" . @a[1]' \
      |perl -pe 's=../../../img/=../img/=;  s=/post/20\d\d/img/=../img/=g'
  ) >| $DIR/index.html
done

# import imagery
rsync -Pav $POOH/img/ img/

# import comments
rsync -Pav $POOH/comments/ comments/
# add/update `index.json` files
$HOME/d/blogtini/bin/comments
